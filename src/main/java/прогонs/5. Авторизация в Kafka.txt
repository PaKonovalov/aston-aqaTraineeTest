TLS шифрование
Обеспечивает шифрование соединения между брокерами Kafka, серверами Zookeeper, клиентами и брокерами.
Вся ключевая информация помещается в хранилища — keystore, которые разделяют на два вида:

- keystore, где хранятся ключи и сертификаты стороны, в отношении которой пройдет процедура аутентификации
и установления защищенного соединения, например, приватный ключ и ассоциированный с ним и подписанный со
стороны центра сертификации (ЦC) сертификат.

- truststore, куда помещаются сертификаты, которым доверяет носитель хранилища.

Общий процесс настройки TLS выглядит так:

Для каждого сервера брокера и Zookeeper создаем keystore:

Создаем keystore + генерируем ключевую пару — закрытый ключ и соответствующую цепь сертификатов (certificate chain),
в которой после выполнения команды будет самоподписанный сертификат, содержащий его открытый ключ.

Создаем запрос на подпись для ЦC.

Подписываем запрос закрытым ключом ЦC. В нашем случае есть промежуточный ЦC и корневой ЦC.

Подписанный запрос импортируем в созданный ранее keystore, в цепочку сертификатов закрытого ключа.
Сначала импортируем сертификаты всех ЦС, подписавших наш запрос, и только потом сам подписанный запрос.
Это необходимо для точного установления цепи сертификатов, которая производится утилитой keytool, иначе получим ошибку.

Производим настройки конфигурации брокеров, серверов Zookeeper и клиентов.

В итоге на брокере и серверах Zookeeper мы получим keystore с 3 ключевыми объектами:

    - сертификат промежуточного ЦC, подписанный корневым ЦC;

    - самоподписанный сертификат корневого ЦC;

    - приватный ключ сервера со связанной цепью сертификатов: серверный сертификат, подписанный промежуточным ЦC;

    - сертификат промежуточного ЦC, подписанный корневым ЦC и самоподписанный сертификат корневого ЦC.

Создаем truststore для клиентов и брокеров (для взаимодействия в качестве клиента с хостами Zookeeper) и в него
импортируем сертификаты ЦC, чьим подписям клиент должен доверять.

Здесь односторонняя аутентификация, т.е. клиент проверяет брокера и Zookeeper серверы брокера. Если нужно настроить
двухстороннюю аутентификацию, проверку клиента или Zookeeper серверы на брокере, проделываем те же операции, что и
на брокере, по созданию keystore на клиенте, а на Zookeeper создаем соответствующий truststore.

Важно отметить, что при создании клиентов и при использовании библиотеки librdkafka сертификаты доверенных ЦС могут
браться клиентом непосредственно из  операционной системы (ОС). К примеру, для машин на Windows необходимо на клиенте
задавать настройку:

ssl.ca.certificate.stores=CA,Root

По умолчанию предполагается только Root и если сертификат сервера подписан еще и промежуточным ЦС, клиент не сможет
установить цепь доверия и получит ошибку, поэтому нужно указывать CA.

В дистрибутиве Apache Kafka от Confluent предусмотрена директория для размещения файлов, необходимых для настройки TLS.
Внутри контейнера это /etc/kafka/secrets. Для размещения файлов необходимо в конфигурационном файле деплоя образов
прописать признак монтирования данной директории.

Далее рассмотрим настройку брокера и сервера Apache Zookeeper в составе кластера Apache Kafka. На остальных
представителях кластера конфигурация аналогичная.